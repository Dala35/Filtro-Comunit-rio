<!DOCTYPE html>
<html lang="pt-PT">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CTX-432 | Gestão e Biointeligência</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        body { font-family: 'Inter', sans-serif; transition: background 0.3s; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .scan-line { animation: scan 2s infinite linear; }
        @keyframes scan { 0% { top: 0%; } 100% { top: 100%; } }
        .active-tab-shadow { box-shadow: 0 4px 14px 0 rgba(217, 119, 6, 0.39); }
        
        /* Estilização das camadas do filtro */
        .layer-transition { transition: all 0.6s cubic-bezier(0.34, 1.56, 0.64, 1); }
        .layer-6 { background: #cbd5e1; height: 10%; } /* Vedação */
        .layer-5 { background: #065f46; height: 15%; } /* Folhas */
        .layer-4 { background: #fde68a; height: 25%; } /* Areia */
        .layer-3 { background: #1c1917; height: 20%; } /* Carvão */
        .layer-2 { background: #a8a29e; height: 20%; } /* Pedra-pomes */
        .layer-1 { background: #e2e8f0; height: 10%; } /* Base */
    </style>
</head>
<body class="bg-stone-50 text-stone-900 pb-24">

    <!-- Header com Status de Conexão Real -->
    <header class="bg-stone-900 text-stone-100 p-6 shadow-xl border-b-4 border-amber-600 sticky top-0 z-50">
        <div class="max-w-4xl mx-auto flex items-center justify-between">
            <div>
                <h1 class="text-2xl font-black tracking-tighter flex items-center gap-2">
                    <i data-lucide="droplets" class="text-sky-400"></i> CTX-432
                </h1>
                <p id="connection-status" class="text-[10px] text-emerald-400 font-bold uppercase tracking-widest flex items-center gap-1">
                    <span class="w-2 h-2 bg-emerald-500 rounded-full animate-ping"></span> Sistema Ativo
                </p>
            </div>
            <div class="text-right">
                <div id="unit-counter" class="text-amber-500 font-black text-xl leading-none">01</div>
                <p class="text-[9px] text-stone-400 uppercase font-bold">Unidade Local</p>
            </div>
        </div>
    </header>

    <main class="max-w-4xl mx-auto p-4 md:p-6 space-y-6">
        
        <!-- Manual de Voz Real (Web Speech API) -->
        <div class="bg-white border-2 border-amber-100 p-4 rounded-3xl flex flex-col md:flex-row items-center gap-4 justify-between shadow-sm">
            <div class="flex items-center gap-4">
                <button onclick="speakInstruction()" id="voice-trigger" class="p-4 rounded-full bg-amber-600 text-white hover:scale-105 transition-transform shadow-lg shadow-amber-900/20">
                    <i data-lucide="volume-2" id="speaker-icon"></i>
                </button>
                <div>
                    <h4 class="text-sm font-black text-stone-800 uppercase">Guia Auditivo</h4>
                    <p id="voice-status" class="text-[11px] text-stone-500">Instruções em tempo real para montagem.</p>
                </div>
            </div>
            <div class="flex items-center gap-2 w-full md:w-auto">
                <select id="lang-select" class="bg-stone-100 border-none text-xs font-bold py-3 px-4 rounded-2xl focus:ring-2 focus:ring-amber-500 flex-1 md:min-w-[150px]">
                    <option value="pt-PT">Português</option>
                    <option value="pt-BR">Português (BR)</option>
                </select>
            </div>
        </div>

        <!-- Navegação Principal -->
        <div class="grid grid-cols-4 bg-stone-200/50 p-1.5 rounded-2xl gap-1 shadow-inner">
            <button onclick="switchTab('inventory')" id="tab-inventory" class="tab-btn flex flex-col items-center py-3 rounded-xl text-[10px] font-black transition-all bg-white text-amber-700 active-tab-shadow">
                <i data-lucide="package" class="mb-1"></i> MATERIAIS
            </button>
            <button onclick="switchTab('assembly')" id="tab-assembly" class="tab-btn flex flex-col items-center py-3 rounded-xl text-[10px] font-black transition-all text-stone-500">
                <i data-lucide="trello" class="mb-1"></i> MONTAGEM
            </button>
            <button onclick="switchTab('kia')" id="tab-kia" class="tab-btn flex flex-col items-center py-3 rounded-xl text-[10px] font-black transition-all text-stone-500">
                <i data-lucide="zap" class="mb-1"></i> TESTE KIA
            </button>
            <button onclick="switchTab('impact')" id="tab-impact" class="tab-btn flex flex-col items-center py-3 rounded-xl text-[10px] font-black transition-all text-stone-500">
                <i data-lucide="map" class="mb-1"></i> REDE
            </button>
        </div>

        <!-- Área de Conteúdo Dinâmica -->
        <section id="content-area" class="min-h-[400px]">
            <!-- Conteúdo carregado via JavaScript -->
        </section>

    </main>

    <!-- Modal de Sucesso -->
    <div id="success-modal" class="fixed inset-0 bg-stone-900/80 backdrop-blur-sm z-[100] hidden flex items-center justify-center p-6">
        <div class="bg-white rounded-[3rem] p-10 max-w-sm w-full text-center space-y-6 shadow-2xl">
            <div class="w-24 h-24 bg-emerald-100 text-emerald-600 rounded-full flex items-center justify-center mx-auto animate-bounce">
                <i data-lucide="award" size="48"></i>
            </div>
            <div>
                <h2 class="text-2xl font-black text-stone-900 leading-tight">Sucesso Bio-Digital!</h2>
                <p class="text-sm text-stone-500 mt-2">A unidade CTX-432 foi validada. O fluxo de água segura está garantido.</p>
            </div>
            <button onclick="closeModal()" class="w-full bg-stone-900 text-white font-bold py-5 rounded-2xl hover:bg-stone-800 transition-colors">Confirmar Registo</button>
        </div>
    </div>

    <script>
        // --- DATA & ESTADO ---
        let activeTab = 'inventory';
        let completedSteps = JSON.parse(localStorage.getItem('ctx432_steps')) || [];
        let materialsOwned = JSON.parse(localStorage.getItem('ctx432_materials')) || [];

        const materials = [
            { id: 'm1', name: 'Recipiente 200L', info: 'Bombona plástica' },
            { id: 'm2', name: 'Carvão Ativado', info: '4kg de coco/madeira' },
            { id: 'm3', name: 'Areia de Quartzo', info: '6kg limpa' },
            { id: 'm4', name: 'Pedra-pomes', info: '5kg granulometria média' },
            { id: 'm5', name: 'Folhas de Moringa', info: '200g desidratadas' },
            { id: 'm6', name: 'Malha Têxtil', info: '2 filtros circulares' }
        ];

        // Steps organizados de baixo para cima na montagem física
        const steps = [
            { id: 1, name: 'Base e Malha 1', desc: 'Coloque a malha no fundo.', class: 'layer-1' },
            { id: 2, name: 'Pedra-pomes', desc: 'Camada de drenagem inicial.', class: 'layer-2' },
            { id: 3, name: 'Carvão Ativado', desc: 'Filtragem química central.', class: 'layer-3' },
            { id: 4, name: 'Areia de Quartzo', desc: 'Filtragem de partículas.', class: 'layer-4' },
            { id: 5, name: 'Bio-Camada Moringa', desc: 'Acabamento antibacteriano.', class: 'layer-5' },
            { id: 6, name: 'Vedação e Malha 2', desc: 'Proteção final superior.', class: 'layer-6' }
        ];

        // --- LÓGICA CORE ---

        function switchTab(tabId) {
            activeTab = tabId;
            render();
            window.scrollTo(0, 0);
        }

        function toggleMaterial(id) {
            materialsOwned = materialsOwned.includes(id) 
                ? materialsOwned.filter(m => m !== id) 
                : [...materialsOwned, id];
            localStorage.setItem('ctx432_materials', JSON.stringify(materialsOwned));
            render();
        }

        function toggleStep(id) {
            // Regra de Negócio: Só pode marcar um passo se o anterior estiver concluído (opcional, mas bom para educação)
            completedSteps = completedSteps.includes(id) 
                ? completedSteps.filter(s => s !== id) 
                : [...completedSteps, id];
            localStorage.setItem('ctx432_steps', JSON.stringify(completedSteps));
            render();
        }

        function speakInstruction() {
            const synth = window.speechSynthesis;
            if (synth.speaking) { synth.cancel(); return; }

            let text = "";
            if (activeTab === 'inventory') {
                const missing = materials.length - materialsOwned.length;
                text = missing > 0 ? `Ainda faltam ${missing} materiais para começar.` : "Todos os materiais estão prontos para a montagem.";
            } else if (activeTab === 'assembly') {
                const next = steps.find(s => !completedSteps.includes(s.id));
                text = next ? `Agora, execute o seguinte: ${next.name}. ${next.desc}` : "A montagem física está completa.";
            } else {
                text = "Inicie o scanner para validação molecular da água.";
            }

            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = document.getElementById('lang-select').value;
            synth.speak(utterance);
        }

        function runKiaScan() {
            const btn = document.getElementById('scan-btn');
            if (completedSteps.length < steps.length) {
                btn.classList.add('bg-red-600', 'animate-shake');
                btn.innerHTML = `<i data-lucide="alert-triangle"></i> ERRO: FILTRO INCOMPLETO`;
                lucide.createIcons();
                setTimeout(() => render(), 2000);
                return;
            }

            btn.disabled = true;
            btn.innerHTML = `<i data-lucide="loader" class="animate-spin"></i> LENDO DENSIDADE...`;
            lucide.createIcons();

            setTimeout(() => {
                document.getElementById('success-modal').classList.remove('hidden');
                btn.disabled = false;
            }, 3000);
        }

        function closeModal() {
            document.getElementById('success-modal').classList.add('hidden');
            switchTab('impact');
        }

        // --- MOTOR DE RENDERIZAÇÃO ---

        function render() {
            // Nav Updates
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('bg-white', 'text-amber-700', 'active-tab-shadow');
                btn.classList.add('text-stone-500');
            });
            document.getElementById(`tab-${activeTab}`).classList.add('bg-white', 'text-amber-700', 'active-tab-shadow');

            const container = document.getElementById('content-area');

            if (activeTab === 'inventory') {
                container.innerHTML = `
                    <div class="space-y-4 animate-in fade-in duration-300">
                        <h2 class="font-black text-xl uppercase italic tracking-tight">Preparação de Materiais</h2>
                        <div class="grid gap-3">
                            ${materials.map(m => `
                                <div onclick="toggleMaterial('${m.id}')" class="bg-white p-5 rounded-3xl border-2 transition-all cursor-pointer flex justify-between items-center ${materialsOwned.includes(m.id) ? 'border-amber-500 bg-amber-50/30' : 'border-stone-100'}">
                                    <div>
                                        <h4 class="font-bold text-stone-800">${m.name}</h4>
                                        <p class="text-[10px] text-stone-500 font-bold uppercase tracking-widest">${m.info}</p>
                                    </div>
                                    <div class="w-10 h-10 rounded-2xl border-2 flex items-center justify-center transition-all ${materialsOwned.includes(m.id) ? 'bg-amber-500 border-amber-500 text-white rotate-12' : 'border-stone-200 text-stone-300'}">
                                        <i data-lucide="${materialsOwned.includes(m.id) ? 'check' : 'plus'}" size="20"></i>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            } else if (activeTab === 'assembly') {
                container.innerHTML = `
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8 animate-in slide-in-from-bottom-4 duration-300">
                        <div class="space-y-4">
                            <h2 class="font-black text-xl uppercase italic">Sequência de Camadas</h2>
                            <div class="space-y-3">
                                ${steps.slice().reverse().map(s => `
                                    <div onclick="toggleStep(${s.id})" class="flex items-center gap-4 cursor-pointer group">
                                        <div class="w-12 h-12 rounded-2xl border-2 flex items-center justify-center shrink-0 transition-all ${completedSteps.includes(s.id) ? 'bg-emerald-500 border-emerald-500 text-white' : 'bg-white border-stone-200 text-stone-300 group-hover:border-amber-400'}">
                                            <span class="font-black text-sm">${s.id}</span>
                                        </div>
                                        <div class="bg-white p-4 rounded-2xl border border-stone-100 flex-1 shadow-sm">
                                            <h4 class="font-bold text-sm ${completedSteps.includes(s.id) ? 'text-stone-400 line-through' : 'text-stone-800'}">${s.name}</h4>
                                            <p class="text-[10px] text-stone-500 font-medium">${s.desc}</p>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>

                        <!-- FILTRO VISUAL DINÂMICO -->
                        <div class="flex flex-col items-center sticky top-24 h-fit">
                            <div class="w-48 h-80 border-x-[10px] border-b-[10px] border-stone-800 rounded-b-[4rem] relative bg-stone-200 overflow-hidden shadow-2xl">
                                <div class="absolute inset-0 bg-stone-100/50"></div>
                                ${steps.map(s => `
                                    <div class="layer-transition absolute left-0 right-0 ${s.class} ${completedSteps.includes(s.id) ? 'translate-y-0 opacity-100' : 'translate-y-full opacity-0'}" 
                                         style="bottom: ${
                                            s.id === 1 ? '0%' : 
                                            s.id === 2 ? '10%' : 
                                            s.id === 3 ? '30%' : 
                                            s.id === 4 ? '50%' : 
                                            s.id === 5 ? '75%' : '90%'
                                         }; width: 100%;">
                                         <div class="w-full h-full opacity-30 bg-[radial-gradient(circle,white_1px,transparent_1px)] bg-[length:4px_4px]"></div>
                                    </div>
                                `).join('')}
                            </div>
                            <div class="mt-6 flex flex-col items-center">
                                <div class="w-4 h-12 bg-stone-800 rounded-b-xl"></div>
                                <div class="mt-2 text-[10px] font-black uppercase tracking-widest ${completedSteps.length === steps.length ? 'text-sky-500' : 'text-stone-300'}">
                                    <i data-lucide="droplets" class="inline mb-1"></i> Fluxo Bio-Ativo
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            } else if (activeTab === 'kia') {
                container.innerHTML = `
                    <div class="max-w-xl mx-auto space-y-8 animate-in zoom-in-95 duration-300">
                        <div class="relative group">
                            <div class="bg-stone-900 aspect-video rounded-[3rem] overflow-hidden relative shadow-2xl border-4 border-stone-800">
                                <div class="scan-line absolute w-full h-1 bg-sky-400 shadow-[0_0_20px_#38bdf8] z-30"></div>
                                <div class="absolute inset-0 bg-[radial-gradient(circle,transparent_20%,rgba(0,0,0,0.8)_100%)]"></div>
                                <div class="absolute inset-0 flex flex-col items-center justify-center text-center p-10">
                                    <div class="relative">
                                        <i data-lucide="focus" class="w-20 h-20 text-white/10 animate-pulse"></i>
                                        <i data-lucide="droplets" class="absolute inset-0 m-auto text-sky-400/50" size="32"></i>
                                    </div>
                                    <h3 class="text-white font-black text-xs uppercase tracking-[0.4em] mt-4">Bio-Óptico Ativo</h3>
                                    <p class="text-stone-500 text-[10px] mt-2">Alinhe o sensor com o fluxo de saída para verificar a eficácia molecular do filtro.</p>
                                </div>
                            </div>
                        </div>
                        <button id="scan-btn" onclick="runKiaScan()" class="w-full bg-stone-900 text-white font-black py-6 rounded-[2rem] shadow-2xl hover:bg-stone-800 active:scale-95 transition-all flex items-center justify-center gap-4">
                            <i data-lucide="shield-check" class="text-sky-400"></i> VALIDAR QUALIDADE DA ÁGUA
                        </button>
                    </div>
                `;
            } else if (activeTab === 'impact') {
                container.innerHTML = `
                    <div class="space-y-6 animate-in fade-in duration-500">
                        <div class="bg-stone-900 p-8 rounded-[3rem] text-white overflow-hidden relative">
                            <i data-lucide="globe" class="absolute -right-10 -top-10 w-48 h-48 opacity-10"></i>
                            <div class="relative z-10 space-y-4">
                                <h2 class="font-black text-2xl tracking-tighter uppercase italic">Rede Local Namibe</h2>
                                <div class="grid grid-cols-2 gap-4">
                                    <div class="bg-white/10 p-4 rounded-2xl backdrop-blur">
                                        <p class="text-[9px] font-bold text-stone-400 uppercase">Unidades</p>
                                        <p class="text-2xl font-black">12</p>
                                    </div>
                                    <div class="bg-white/10 p-4 rounded-2xl backdrop-blur">
                                        <p class="text-[9px] font-bold text-stone-400 uppercase">Litros/Dia</p>
                                        <p class="text-2xl font-black">2.4k</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white p-6 rounded-[2.5rem] border-2 border-stone-100 flex items-center justify-between">
                            <div class="flex items-center gap-4">
                                <div class="w-12 h-12 bg-amber-100 text-amber-600 rounded-full flex items-center justify-center">
                                    <i data-lucide="map-pin"></i>
                                </div>
                                <div>
                                    <h4 class="font-bold text-sm">Sincronizar GPS</h4>
                                    <p class="text-[10px] text-stone-400 font-medium tracking-tight">Registar localização desta unidade.</p>
                                </div>
                            </div>
                            <button onclick="this.innerText='LOCALIZADO'" class="bg-stone-100 px-6 py-3 rounded-2xl font-black text-[10px] hover:bg-stone-200 transition-colors uppercase tracking-widest">Ativar</button>
                        </div>
                    </div>
                `;
            }
            lucide.createIcons();
        }

        // Inicialização
        window.onload = () => {
            render();
            console.log("Sistema CTX-432 Inicializado com sucesso.");
        };
    </script>
</body>
</html>
